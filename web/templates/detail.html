{{define "content"}}
<div class="mb-6">
    <a href="/pending" class="btn btn-ghost btn-sm" style="padding-left: 0;">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 16px; height: 16px;">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
        </svg>
        Back to Pending
    </a>
</div>

<div class="card mb-8">
    <div class="card-header">
        <div class="flex items-center justify-between" style="flex-wrap: wrap; gap: var(--space-3);">
            <div>
                <h2>Request Details</h2>
                <p class="font-mono text-sm">{{.Request.ID}}</p>
            </div>
            <span class="badge 
                {{if eq .Request.Status "pending_approval"}}badge-primary
                {{else if eq .Request.Status "approved"}}badge-success
                {{else if eq .Request.Status "denied"}}badge-error
                {{else}}badge-default{{end}}">
                {{.Request.Status}}
            </span>
        </div>
    </div>
    <div class="card-body">
        <dl class="dl-grid mb-8">
            <div class="dl-item">
                <dt>Operation</dt>
                <dd>{{.Request.Operation}}</dd>
            </div>
            <div class="dl-item">
                <dt>API Key</dt>
                <dd class="font-mono">{{.Request.APIKeyID}}</dd>
            </div>
            <div class="dl-item">
                <dt>Created</dt>
                <dd>{{formatTime .Request.CreatedAt}}</dd>
            </div>
            <div class="dl-item">
                <dt>Expires</dt>
                <dd>{{formatTime .Request.ExpiresAt}}</dd>
            </div>
            {{if .Request.DecidedAt.Valid}}
            <div class="dl-item">
                <dt>Decided At</dt>
                <dd>{{formatTime .Request.DecidedAt.Time}}</dd>
            </div>
            {{end}}
            {{if .Request.DecidedBy.Valid}}
            <div class="dl-item">
                <dt>Decided By</dt>
                <dd>{{.Request.DecidedBy.String}}</dd>
            </div>
            {{end}}
        </dl>

        <!-- Payload -->
        <div class="mb-8">
            <h5 style="margin-bottom: var(--space-3);">Request Payload</h5>
            <pre>{{formatJSON .Payload}}</pre>
        </div>

        {{if .Request.SuggestionText.Valid}}
        <div class="alert alert-warning mb-6">
            <h5 style="margin-bottom: var(--space-2);">Suggested Change</h5>
            <p style="margin-bottom: var(--space-2);">{{.Request.SuggestionText.String}}</p>
            <p class="text-xs" style="color: var(--text-tertiary); margin: 0;">
                Suggested by {{.Request.SuggestionBy.String}} at {{formatTime .Request.SuggestionAt.Time}}
            </p>
        </div>
        {{end}}

        {{if .Request.Error.Valid}}
        <div class="alert alert-error mb-6">
            <h5 style="margin-bottom: var(--space-2);">Error</h5>
            <p style="margin: 0;">{{.Request.Error.String}}</p>
        </div>
        {{end}}

        {{if .Request.Result}}
        <div>
            <h5 style="margin-bottom: var(--space-3);">Result</h5>
            <pre style="background-color: var(--color-success-50); border-color: var(--color-success-600);">{{formatJSON .Request.Result}}</pre>
        </div>
        {{end}}
    </div>

    <!-- Actions -->
    {{if eq .Request.Status "pending_approval"}}
    <div class="card-footer">
        <div style="display: flex; flex-wrap: wrap; gap: var(--space-3); margin-bottom: var(--space-4);">
            <form action="/requests/{{.Request.ID}}/approve" method="POST" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                <button type="submit" class="btn btn-success">Approve Request</button>
            </form>
            <form action="/requests/{{.Request.ID}}/deny" method="POST" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                <button type="submit" class="btn btn-danger">Deny Request</button>
            </form>
        </div>

        <!-- Suggest Change Form -->
        <div class="pt-6 border-t">
            <form action="/requests/{{.Request.ID}}/suggest" method="POST">
                <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
                <div class="form-row" style="align-items: flex-end;">
                    <div class="form-group mb-0" style="flex: 1;">
                        <label for="suggestion" class="form-label">Suggest a Change</label>
                        <input type="text" id="suggestion" name="suggestion" 
                               placeholder="Enter your suggestion for this request..."
                               class="form-input" required>
                    </div>
                    <div>
                        <button type="submit" class="btn btn-secondary">Submit Suggestion</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    {{end}}
</div>

<!-- Audit Log -->
{{if .AuditEntries}}
<div class="card">
    <div class="card-header">
        <h3>Audit Log</h3>
        <p>Activity history for this request</p>
    </div>
    <div class="list-group" style="border: none; border-top: 1px solid var(--border-subtle);">
        {{range .AuditEntries}}
        <div class="list-item">
            <div>
                <span style="font-weight: 500; color: var(--text-primary);">{{.EventType}}</span>
                <span class="text-sm" style="color: var(--text-tertiary); margin-left: var(--space-2);">by {{.Actor}}</span>
            </div>
            <span class="text-sm" style="color: var(--text-tertiary);">{{formatTime .Timestamp}}</span>
        </div>
        {{end}}
    </div>
</div>
{{end}}
{{end}}

{{template "layout" .}}
