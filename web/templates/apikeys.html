{{define "content"}}
<div class="page-header">
    <h1>API Keys</h1>
    <p>Manage access credentials for calendar operations</p>
</div>

<!-- Create New Key Form -->
<div class="card mb-8 animate-fade-in-scale">
    <div class="card-header">
        <h3>Create New API Key</h3>
        <p>Generate a new key for your applications</p>
    </div>
    <div class="card-body">
        <form action="/apikeys" method="POST"
              hx-post="/apikeys" hx-target="#key-result" hx-swap="innerHTML">
            <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
            
            <div class="form-row">
                <div class="form-group mb-0">
                    <label for="name" class="form-label">Key Name</label>
                    <input type="text" name="name" id="name" required
                           class="form-input"
                           placeholder="e.g., Production API Client">
                </div>
                <div class="form-group mb-0">
                    <label for="tier" class="form-label">Access Tier</label>
                    <select name="tier" id="tier" required class="form-select">
                        <option value="read">Read Only &mdash; View calendars and events</option>
                        <option value="write" selected>Write &mdash; Full access with approval</option>
                        <option value="admin">Admin &mdash; Includes web UI access</option>
                    </select>
                </div>
            </div>
            
            <div class="mt-6">
                <button type="submit" class="btn btn-primary">Create API Key</button>
            </div>
        </form>
        <div id="key-result"></div>
    </div>
</div>

<!-- Existing Keys -->
{{if .Keys}}
<div class="card animate-fade-in-scale" style="animation-delay: 50ms;">
    <div class="card-header">
        <h3>Active API Keys</h3>
        <p>Your current API credentials</p>
    </div>
    <div class="table-container">
        <table class="table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Prefix</th>
                    <th>Tier</th>
                    <th>Created</th>
                    <th>Last Used</th>
                    <th style="text-align: right;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {{range .Keys}}
                <tr>
                    <td style="color: var(--text-primary); font-weight: 500;">{{.Name}}</td>
                    <td class="font-mono" style="font-size: var(--text-xs);">{{.KeyPrefix}}</td>
                    <td>
                        {{if eq .Tier "admin"}}
                        <span class="badge badge-warning">{{.Tier}}</span>
                        {{else if eq .Tier "write"}}
                        <span class="badge badge-primary">{{.Tier}}</span>
                        {{else}}
                        <span class="badge badge-default">{{.Tier}}</span>
                        {{end}}
                    </td>
                    <td>{{formatDate .CreatedAt}}</td>
                    <td>
                        {{if .LastUsedAt.Valid}}{{formatDate .LastUsedAt.Time}}{{else}}<span style="color: var(--text-muted);">Never</span>{{end}}
                    </td>
                    <td style="text-align: right;">
                        <form action="/apikeys/{{.ID}}/revoke" method="POST" style="display: inline;"
                              onsubmit="return confirm('Are you sure you want to revoke this API key? This action cannot be undone.');">
                            <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                            <button type="submit" class="btn btn-ghost btn-sm" style="color: var(--error-700);">Revoke</button>
                        </form>
                    </td>
                </tr>
                {{end}}
            </tbody>
        </table>
    </div>
</div>
{{else}}
<div class="empty-state animate-fade-in">
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor" class="empty-state-icon">
        <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z" />
    </svg>
    <h3>No API Keys</h3>
    <p>Create your first API key to start using SchedLock with your applications.</p>
</div>
{{end}}

<!-- Tier Documentation -->
<div class="card mt-8 animate-fade-in-scale" style="background-color: var(--bg-secondary); animation-delay: 100ms;">
    <div class="card-body">
        <h4 style="font-family: var(--font-serif); margin-bottom: var(--space-5); font-weight: 500;">API Key Tiers</h4>
        <dl style="display: grid; gap: var(--space-5);">
            <div>
                <dt style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-1); font-size: var(--text-sm);">Read</dt>
                <dd style="font-size: var(--text-sm); color: var(--text-secondary); margin: 0;">View calendars, events, and free/busy information. No write operations permitted.</dd>
            </div>
            <div>
                <dt style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-1); font-size: var(--text-sm);">Write</dt>
                <dd style="font-size: var(--text-sm); color: var(--text-secondary); margin: 0;">Create, update, and delete events (with approval). Includes all read permissions.</dd>
            </div>
            <div>
                <dt style="font-weight: 600; color: var(--text-primary); margin-bottom: var(--space-1); font-size: var(--text-sm);">Admin</dt>
                <dd style="font-size: var(--text-sm); color: var(--text-secondary); margin: 0;">Full API access including statistics and audit logs. For monitoring tools and administrative functions.</dd>
            </div>
        </dl>
    </div>
</div>
{{end}}

{{template "layout" .}}
