{{define "content"}}
<div class="approve-page">
    <div class="approve-brand">
        <span>SchedLock</span>
    </div>

    {{if .Error}}
    <div class="approve-card approve-card-result">
        <div class="approve-result-icon approve-result-error">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z" />
            </svg>
        </div>
        <h2 class="approve-result-title">{{.ErrorTitle}}</h2>
        <p class="approve-result-message">{{.Error}}</p>
        {{if .ShowLoginLink}}
        <a href="/login" class="btn btn-primary">Sign In</a>
        {{end}}
    </div>
    {{else if .Success}}
    <div class="approve-card approve-card-result">
        {{if eq .Action "approve"}}
        <div class="approve-result-icon approve-result-success">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        </div>
        {{else}}
        <div class="approve-result-icon approve-result-denied">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
            </svg>
        </div>
        {{end}}
        <h2 class="approve-result-title">Request {{if eq .Action "approve"}}Approved{{else}}Denied{{end}}</h2>
        <p class="approve-result-message">{{.Message}}</p>
        <a href="/" class="btn btn-secondary">Go to Dashboard</a>
    </div>
    {{else}}
    <div class="approve-card">
        <div class="approve-header">
            <span class="badge badge-primary">Pending Approval</span>
            <p class="approve-summary">
                {{if eq .Request.Operation "create_event"}}
                An AI agent is requesting to <strong>create a new calendar event</strong>{{if .EventDetails.Title}} called "{{.EventDetails.Title}}"{{end}}.
                {{else if eq .Request.Operation "update_event"}}
                An AI agent is requesting to <strong>modify an existing calendar event</strong>{{if .EventDetails.Title}} ("{{.EventDetails.Title}}"){{end}}.
                {{else if eq .Request.Operation "delete_event"}}
                An AI agent is requesting to <strong>delete a calendar event</strong>{{if .EventDetails.Title}} called "{{.EventDetails.Title}}"{{end}}.
                {{else}}
                An AI agent is requesting to perform a calendar operation.
                {{end}}
            </p>
            <p class="approve-expires">Expires {{.ExpiresIn}}</p>
        </div>

        <div class="approve-details">
            {{if .EventDetails.Title}}
            <div class="approve-detail-row">
                <span class="approve-detail-label">Event</span>
                <span class="approve-detail-value">{{.EventDetails.Title}}</span>
            </div>
            {{end}}
            {{if .EventDetails.StartTime}}
            <div class="approve-detail-row">
                <span class="approve-detail-label">When</span>
                <span class="approve-detail-value">{{.EventDetails.StartTime}}</span>
            </div>
            {{end}}
            {{if .EventDetails.Location}}
            <div class="approve-detail-row">
                <span class="approve-detail-label">Where</span>
                <span class="approve-detail-value">{{.EventDetails.Location}}</span>
            </div>
            {{end}}
            {{if .EventDetails.Description}}
            <div class="approve-detail-row">
                <span class="approve-detail-label">Description</span>
                <span class="approve-detail-value">{{.EventDetails.Description}}</span>
            </div>
            {{end}}
            {{if .EventDetails.Attendees}}
            <div class="approve-detail-row">
                <span class="approve-detail-label">Attendees</span>
                <span class="approve-detail-value">{{.EventDetails.Attendees}}</span>
            </div>
            {{end}}
        </div>

        {{if .RequiresPIN}}
        <div class="approve-pin">
            <label class="approve-pin-label">Enter PIN to continue</label>
            <input type="password" id="approval-pin" name="pin" class="approve-pin-input"
                   pattern="[0-9]*" inputmode="numeric" maxlength="8" placeholder="****"
                   autocomplete="off" required>
            {{if .PINError}}
            <p class="approve-pin-error">{{.PINError}}</p>
            {{end}}
        </div>
        {{end}}

        <div class="approve-actions">
            <form action="/approve/{{.Token}}" method="POST" class="approve-form" id="approve-form">
                <input type="hidden" name="action" value="approve">
                {{if .RequiresPIN}}<input type="hidden" name="pin" class="pin-field">{{end}}
                <button type="submit" class="btn btn-success btn-lg">Approve</button>
            </form>
            <form action="/approve/{{.Token}}" method="POST" class="approve-form" id="deny-form">
                <input type="hidden" name="action" value="deny">
                {{if .RequiresPIN}}<input type="hidden" name="pin" class="pin-field">{{end}}
                <button type="submit" class="btn btn-danger btn-lg">Deny</button>
            </form>
        </div>

        {{if .RequiresPIN}}
        <script>
        // Copy PIN to form fields on submit
        document.querySelectorAll('.approve-form').forEach(form => {
            form.addEventListener('submit', function(e) {
                const pin = document.getElementById('approval-pin').value;
                if (!pin) {
                    e.preventDefault();
                    document.getElementById('approval-pin').focus();
                    return;
                }
                this.querySelector('.pin-field').value = pin;
            });
        });
        </script>
        {{end}}

        <div class="approve-footer">
            <a href="/login?redirect=/requests/{{.Request.ID}}" class="approve-link">Sign in for more details</a>
        </div>
    </div>
    {{end}}
</div>

<style>
.approve-page {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: var(--space-4);
    background: var(--bg-canvas);
}

.approve-brand {
    font-family: var(--font-serif);
    font-size: var(--text-xl);
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: var(--space-6);
}

.approve-card {
    background: var(--bg-primary);
    border: 1px solid var(--border-subtle);
    border-radius: 12px;
    box-shadow: var(--shadow-lg);
    width: 100%;
    max-width: 420px;
    overflow: hidden;
}

.approve-card-result {
    text-align: center;
    padding: var(--space-8) var(--space-6);
}

.approve-result-icon {
    width: 72px;
    height: 72px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto var(--space-5);
}

.approve-result-icon svg {
    width: 36px;
    height: 36px;
}

.approve-result-success {
    background: var(--success-100);
    color: var(--success-700);
}

.approve-result-denied {
    background: var(--warning-100);
    color: var(--warning-700);
}

.approve-result-error {
    background: var(--error-100);
    color: var(--error-700);
}

.approve-result-title {
    font-size: var(--text-xl);
    margin-bottom: var(--space-2);
}

.approve-result-message {
    color: var(--text-secondary);
    margin-bottom: var(--space-5);
    line-height: var(--leading-relaxed);
}

.approve-card-result .btn {
    margin-top: var(--space-2);
}

.approve-card-error h2,
.approve-card-success h2 {
    margin-bottom: var(--space-2);
}

.approve-card-error p,
.approve-card-success p {
    color: var(--text-secondary);
    margin: 0;
}

.approve-header {
    padding: var(--space-6);
    border-bottom: 1px solid var(--border-subtle);
    text-align: center;
}

.approve-summary {
    font-size: var(--text-base);
    color: var(--text-primary);
    line-height: var(--leading-relaxed);
    margin: var(--space-4) 0 var(--space-3);
}

.approve-summary strong {
    color: var(--accent);
}

.approve-expires {
    font-size: var(--text-sm);
    color: var(--text-tertiary);
    margin: 0;
}

.approve-details {
    padding: var(--space-4) var(--space-6);
}

.approve-detail-row {
    display: flex;
    flex-direction: column;
    padding: var(--space-3) 0;
    border-bottom: 1px solid var(--border-subtle);
}

.approve-detail-row:last-child {
    border-bottom: none;
}

.approve-detail-label {
    font-size: var(--text-xs);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    color: var(--text-tertiary);
    margin-bottom: var(--space-1);
}

.approve-detail-value {
    color: var(--text-primary);
    word-break: break-word;
}

.approve-pin {
    padding: var(--space-4) var(--space-6);
    text-align: center;
    border-top: 1px solid var(--border-subtle);
}

.approve-pin-label {
    display: block;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: var(--space-2);
}

.approve-pin-input {
    width: 120px;
    padding: var(--space-3);
    font-size: var(--text-xl);
    font-family: var(--font-mono);
    text-align: center;
    letter-spacing: 0.2em;
    border: 2px solid var(--border-default);
    border-radius: 8px;
    background: var(--bg-primary);
    color: var(--text-primary);
}

.approve-pin-input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-subtle);
}

.approve-pin-error {
    color: var(--error-700);
    font-size: var(--text-sm);
    margin-top: var(--space-2);
    margin-bottom: 0;
}

.approve-actions {
    display: flex;
    gap: var(--space-3);
    padding: var(--space-6);
    background: var(--bg-secondary);
    border-top: 1px solid var(--border-subtle);
}

.approve-form {
    flex: 1;
}

.approve-form .btn {
    width: 100%;
}

.btn-lg {
    padding: var(--space-3) var(--space-6);
    font-size: var(--text-base);
}

.approve-footer {
    padding: var(--space-4) var(--space-6);
    text-align: center;
    background: var(--bg-secondary);
}

.approve-link {
    font-size: var(--text-sm);
    color: var(--text-tertiary);
    text-decoration: none;
}

.approve-link:hover {
    color: var(--accent);
}

/* Mobile optimizations */
@media (max-width: 480px) {
    .approve-page {
        padding: var(--space-3);
        justify-content: flex-start;
        padding-top: var(--space-8);
    }

    .approve-card {
        max-width: 100%;
    }

    .approve-header {
        padding: var(--space-5);
    }

    .approve-details {
        padding: var(--space-3) var(--space-5);
    }

    .approve-actions {
        flex-direction: column;
        padding: var(--space-4) var(--space-5);
    }

    .approve-footer {
        padding: var(--space-3) var(--space-5);
    }
}
</style>
{{end}}

{{template "approve-layout" .}}
